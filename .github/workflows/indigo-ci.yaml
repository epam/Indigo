name: Indigo CI

env:
  OS_NAME_MAPPING_JSON: '{"ubuntu-latest": "linux", "windows-latest": "windows", "macos-13": "macos"}'

on:
  push:
    branches:
      - master
    tags:
      - 'indigo-*'
  workflow_dispatch:
  pull_request:
  repository_dispatch:

jobs:
  publish_indigo_to_maven:
    runs-on: ubuntu-latest
    container: epmlsop/indigo-tester:latest
    steps:
      - name: Publish Java jars to Maven Central
        env:
          MAVEN_SETTINGS: ${{ secrets.MAVEN_SETTINGS }}
        run: |
          pwd
          set -eux
          mkdir /root/.m2
          echo ${MAVEN_SETTINGS} > /root/.m2/settings.xml
          gzip /root/.m2/settings.xml
          base64 /root/.m2/settings.xml.gz
