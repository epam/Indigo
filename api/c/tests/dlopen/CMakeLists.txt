cmake_minimum_required(VERSION 3.6)

project(indigo-dlopen-tests LANGUAGES C)

if (ENABLE_TESTS)
    add_executable(${PROJECT_NAME} ${CMAKE_CURRENT_SOURCE_DIR}/indigo-test-dlopen.c)
    target_link_libraries(${PROJECT_NAME} ${CMAKE_DL_LIBS})
    add_test(NAME ${PROJECT_NAME}-indigo
            COMMAND $ENV{INDIGO_QEMU_BINARY} ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${PROJECT_NAME} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX})
    add_test(NAME ${PROJECT_NAME}-indigo-inchi
            COMMAND $ENV{INDIGO_QEMU_BINARY} ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${PROJECT_NAME} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo-inchi${CMAKE_SHARED_LIBRARY_SUFFIX})
    add_test(NAME ${PROJECT_NAME}-indigo-renderer
            COMMAND $ENV{INDIGO_QEMU_BINARY} ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${PROJECT_NAME} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo-renderer${CMAKE_SHARED_LIBRARY_SUFFIX})
    add_test(NAME ${PROJECT_NAME}-bingo-nosql
            COMMAND $ENV{INDIGO_QEMU_BINARY} ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/${PROJECT_NAME} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}bingo-nosql${CMAKE_SHARED_LIBRARY_SUFFIX})
endif()
