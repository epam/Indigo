cmake_minimum_required(VERSION 3.6)

project(indigo-tests LANGUAGES C CXX)

if (ENABLE_TESTS)
    add_executable(${PROJECT_NAME}-dlopen ${CMAKE_CURRENT_SOURCE_DIR}/indigo-test-dlopen.c)
    target_link_libraries(${PROJECT_NAME}-dlopen ${CMAKE_DL_LIBS})
    add_test(NAME ${PROJECT_NAME}-dlopen-indigo
            COMMAND ${PROJECT_NAME}-dlopen ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX})
    if(BUILD_INDIGO_INCHI)
        add_test(NAME ${PROJECT_NAME}-dlopen-indigo-inchi
                COMMAND ${PROJECT_NAME}-dlopen ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo-inchi${CMAKE_SHARED_LIBRARY_SUFFIX})
    endif()
    if (BUILD_INDIGO_RENDERER)
        add_test(NAME ${PROJECT_NAME}-dlopen-indigo-renderer
                COMMAND ${PROJECT_NAME}-dlopen ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo-renderer${CMAKE_SHARED_LIBRARY_SUFFIX})
    endif()
    if (BUILD_BINGO_NOSQL)
        add_test(NAME ${PROJECT_NAME}-dlopen-bingo-nosql
                COMMAND ${PROJECT_NAME}-dlopen ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}indigo${CMAKE_SHARED_LIBRARY_SUFFIX} ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/${CMAKE_SHARED_LIBRARY_PREFIX}bingo-nosql${CMAKE_SHARED_LIBRARY_SUFFIX})
    endif()
endif()
